<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<title>Platform Abstraction Layer API Documentation</title>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<link href="doxygen.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td><img src="images/TCAT.gif" width="399" height="64"></td>
				<td align="right">
					<div align="left">
						</div>
				</td>
				<td align="right">
					<div align="right">
						<b><font face="Verdana, Arial, Helvetica, sans-serif"><img src="images/dice_logo.gif" width="120" height="50"></font></b></div>
				</td>
			</tr>
		</table>
		<hr size="1">
	</body>
</html>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>tcat_dice_pal_system.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//==============================================================================</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// This confidential and proprietary software may be used only as authorised</span>
<a name="l00004"></a>00004 <span class="comment">// by a licensing agreement from TC Applied Technologies Ltd.</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// (C) COPYRIGHT 2004 - 2012 TC Applied Technologies Ltd. (ALL RIGHTS RESERVED)</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Unauthorized use, duplication or distribution of this software is  </span>
<a name="l00009"></a>00009 <span class="comment">// strictly prohibited by law.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// The entire notice above must be reproduced on all authorised copies and</span>
<a name="l00012"></a>00012 <span class="comment">// copies may only be made to the extent permitted by a licensing agreement</span>
<a name="l00013"></a>00013 <span class="comment">// from TC Applied Technologies Ltd.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//==============================================================================</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#pragma once</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;tcat_dice_pal_bus.h&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;../TDL/interface/public/TDL_Interface.h&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#define kDriverLog_File_ID      1002</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="keyword">namespace </span>tcat
<a name="l00026"></a>00026 {
<a name="l00027"></a>00027 <span class="keyword">namespace </span>dice
<a name="l00028"></a>00028 {
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 
<a name="l00595"></a><a class="code" href="classtcat_1_1dice_1_1system__impl.html">00595</a> <span class="keyword">class </span><a class="code" href="classtcat_1_1dice_1_1system__impl.html" title="Platform dependent system implementation.">system_impl</a>: <span class="keyword">public</span> <a class="code" href="classtcat_1_1dice_1_1base.html">base</a>
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597     <span class="keyword">typedef</span> <a class="code" href="classtcat_1_1dice_1_1base.html">base</a>    <a class="code" href="classtcat_1_1dice_1_1base.html">super</a>;
<a name="l00598"></a>00598     <span class="keyword">friend</span>  <span class="keyword">class   </span><a class="code" href="classtcat_1_1dice_1_1bus__impl.html">bus_impl</a>;
<a name="l00599"></a>00599     <span class="keyword">friend</span>  <span class="keyword">class   </span><a class="code" href="classtcat_1_1dice_1_1device.html">device</a>;
<a name="l00600"></a>00600     <span class="keyword">friend</span>  <span class="keyword">class   </span><a class="code" href="classtcat_1_1dice_1_1reference.html" title="Auto reference helper class.">reference</a>&lt;system_impl&gt;;
<a name="l00601"></a>00601 <span class="keyword">public</span>:
<a name="l00602"></a>00602     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>                <a class="code" href="classtcat_1_1dice_1_1system__impl.html#a0c935b614fdd5376580b99dffe6c2f34" title="Refreshes the the system object state fetch.">fetch_buslist</a>()                                 <span class="keywordflow">throw</span>(<a class="code" href="classtcat_1_1exception_1_1base.html">tcat::exception::base</a>);   
<a name="l00603"></a><a class="code" href="classtcat_1_1dice_1_1system__impl.html#a051dc50f8d32a3f44b1b37bb25d29619">00603</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                <a class="code" href="classtcat_1_1dice_1_1system__impl.html#a051dc50f8d32a3f44b1b37bb25d29619" title="Notifies the system object of bus(driver) arrival/removal.">update_buslist</a>()                                            {}                  
<a name="l00604"></a><a class="code" href="classtcat_1_1dice_1_1system__impl.html#af92e91f046b275fd2ee33b25ceaff06b">00604</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                <a class="code" href="classtcat_1_1dice_1_1system__impl.html#af92e91f046b275fd2ee33b25ceaff06b" title="Exception handler to overwrite.">exception</a>(<span class="keyword">const</span> <a class="code" href="classtcat_1_1exception_1_1base.html">tcat::exception::base</a>&amp; <a class="code" href="classtcat_1_1dice_1_1system__impl.html#af92e91f046b275fd2ee33b25ceaff06b" title="Exception handler to overwrite.">exception</a>)           {}                  
<a name="l00605"></a>00605 <span class="keyword">protected</span>:
<a name="l00606"></a>00606                                 <a class="code" href="classtcat_1_1dice_1_1system__impl.html#a4f94ab46f3620a8184eb8835de8e24fd" title="First stage system constructor.">system_impl</a>();                                                                  
<a name="l00607"></a>00607     <span class="keyword">virtual</span>                     <a class="code" href="classtcat_1_1dice_1_1system__impl.html#a949bb6f3f967d5a154fa62b00af36321" title="System destructor.">~system_impl</a>();                                                                 
<a name="l00608"></a>00608     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                <a class="code" href="classtcat_1_1dice_1_1system__impl.html#ad35bca9a1c53dc3b48a0dfe68c92c0aa" title="Second stage critical object creation.">create</a>          ()                              throw(tcat::<a class="code" href="classtcat_1_1dice_1_1system__impl.html#af92e91f046b275fd2ee33b25ceaff06b" title="Exception handler to overwrite.">exception</a>::<a class="code" href="classtcat_1_1dice_1_1base.html">base</a>);   
<a name="l00609"></a>00609     virtual <span class="keywordtype">bool</span>                <a class="code" href="classtcat_1_1dice_1_1system__impl.html#a3fd5a176c93a1f250a189f8e6f8e56ef" title="Creates a bus object.">create_bus</a>      (const <a class="code" href="classtcat_1_1dice_1_1bus__impl.html">bus_impl</a>::ID bus_id) = 0;                                
<a name="l00610"></a>00610     virtual <span class="keywordtype">bool</span>                <a class="code" href="classtcat_1_1dice_1_1system__impl.html#a1d0390f2366bd07da97897bf8cc28fc6" title="Return the availabilty in the OS of the the bus of the given ID.">available</a>       (const <a class="code" href="classtcat_1_1dice_1_1bus__impl.html">bus_impl</a>::ID bus_id)     throw(tcat::<a class="code" href="classtcat_1_1dice_1_1system__impl.html#af92e91f046b275fd2ee33b25ceaff06b" title="Exception handler to overwrite.">exception</a>::base);   
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 private:
<a name="l00613"></a>00613 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00614"></a>00614 <span class="preprocessor"></span>            handle              m_hWnd;                 
<a name="l00615"></a>00615             handle              m_hDevNotify;           
<a name="l00616"></a>00616             handle              m_hThread;              
<a name="l00617"></a>00617             <span class="keywordtype">char</span>                m_UniqueClassName[64];
<a name="l00618"></a>00618 <span class="preprocessor">#endif</span>
<a name="l00619"></a>00619 <span class="preprocessor"></span>
<a name="l00620"></a>00620 <span class="keyword">public</span>:
<a name="l00621"></a>00621 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00622"></a>00622 <span class="preprocessor"></span><span class="comment">//\cond</span>
<a name="l00623"></a>00623             <span class="keywordtype">bool</span>                m_thread_device_arrival_removal_running;
<a name="l00624"></a>00624 <span class="comment">//\endcond</span>
<a name="l00625"></a>00625 <span class="preprocessor">#endif</span>
<a name="l00626"></a>00626 <span class="preprocessor"></span>
<a name="l00627"></a>00627 <span class="preprocessor">#ifdef __MACH__</span>
<a name="l00628"></a>00628 <span class="preprocessor"></span><span class="comment">//\cond</span>
<a name="l00629"></a>00629     <span class="keyword">virtual</span> <span class="keywordtype">void</span>*               thread();               
<a name="l00630"></a>00630     <span class="keyword">virtual</span> <span class="keywordtype">void</span>                callback_runloop_observer();
<a name="l00631"></a>00631     <span class="keyword">static</span>  <span class="keywordtype">void</span>*               static_thread(system_impl*<a class="code" href="classtcat_1_1dice_1_1system.html" title="Application wide singleton acts as the STL device tree root.">system</a>);
<a name="l00632"></a>00632     <span class="keyword">static</span>  <span class="keywordtype">void</span>                static_callback_runloop_observer(<span class="keywordtype">void</span>*, <span class="keywordtype">int</span>, system_impl*<a class="code" href="classtcat_1_1dice_1_1system.html" title="Application wide singleton acts as the STL device tree root.">system</a>);
<a name="l00633"></a>00633             <span class="keywordtype">void</span>*               m_io_notification;      
<a name="l00634"></a>00634             <span class="keywordtype">void</span>*               m_io_runloop;           
<a name="l00635"></a>00635             <span class="keywordtype">void</span>*               m_io_runloop_source;    
<a name="l00636"></a>00636             pthread_t           m_thread;               
<a name="l00637"></a>00637             pthread_mutex_t     m_mutex;                
<a name="l00638"></a>00638             pthread_cond_t      m_cond;                 
<a name="l00639"></a>00639             <span class="keyword">enum</span>
<a name="l00640"></a>00640             {
<a name="l00641"></a>00641                 kStateStarting,
<a name="l00642"></a>00642                 kStateRunning,
<a name="l00643"></a>00643                 kStateTerminating
<a name="l00644"></a>00644             }                   m_state;
<a name="l00645"></a>00645     <a class="code" href="classtcat_1_1exception_1_1base.html">tcat::exception::base</a>       m_exception;            
<a name="l00646"></a>00646 <span class="comment">//\endcond</span>
<a name="l00647"></a>00647 <span class="preprocessor">#endif</span>
<a name="l00648"></a>00648 <span class="preprocessor"></span>};
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 
<a name="l00652"></a>00652 
<a name="l00665"></a><a class="code" href="classtcat_1_1dice_1_1system.html">00665</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> bus_t=bus&lt;device&gt; &gt; <span class="keyword">class </span><a class="code" href="classtcat_1_1dice_1_1system.html" title="Application wide singleton acts as the STL device tree root.">system</a>: <span class="keyword">public</span> system_impl, <span class="keyword">public</span> std::deque&lt;reference&lt;bus_t&gt; &gt;
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classtcat_1_1dice_1_1reference.html">dice::reference&lt;bus_t&gt;</a> <a class="code" href="classtcat_1_1dice_1_1reference.html">bus_ref</a>;
<a name="l00668"></a>00668     <span class="keyword">typedef</span> <span class="keyword">typename</span> std::deque&lt;bus_ref&gt;    <a class="code" href="classtcat_1_1dice_1_1base.html">super</a>;
<a name="l00669"></a>00669     <span class="keyword">typedef</span> <a class="code" href="classtcat_1_1dice_1_1system.html" title="Application wide singleton acts as the STL device tree root.">system&lt;bus_t&gt;</a> <span class="keyword">self</span>;
<a name="l00670"></a>00670 <span class="keyword">public</span>:
<a name="l00671"></a><a class="code" href="classtcat_1_1dice_1_1system.html#a925a0fe9c6bd2faf10222644fa39349c">00671</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> super::iterator        <a class="code" href="classtcat_1_1dice_1_1system.html#a925a0fe9c6bd2faf10222644fa39349c" title="bus object iterator">iterator</a>;                                                           
<a name="l00672"></a><a class="code" href="classtcat_1_1dice_1_1system.html#aed87d285a3f6929ac0331db06f6205fb">00672</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> super::const_iterator  <a class="code" href="classtcat_1_1dice_1_1system.html#aed87d285a3f6929ac0331db06f6205fb" title="bus object const iterator">const_iterator</a>;                                                     
<a name="l00673"></a>00673     
<a name="l00674"></a>00674     <span class="keyword">template</span> &lt;<span class="keyword">class</span> system_t&gt;
<a name="l00675"></a><a class="code" href="classtcat_1_1dice_1_1system.html#a3c1be9e4170014605d2d2332d598aabf">00675</a>     <span class="keyword">static</span>  <a class="code" href="classtcat_1_1dice_1_1reference.html" title="Auto reference helper class.">dice::reference&lt;system_t&gt;</a>   <a class="code" href="classtcat_1_1dice_1_1system.html#a3c1be9e4170014605d2d2332d598aabf" title="&amp;lt; Static object creation">static_create</a>() throw(tcat::<a class="code" href="classtcat_1_1dice_1_1system__impl.html#af92e91f046b275fd2ee33b25ceaff06b" title="Exception handler to overwrite.">exception</a>::<a class="code" href="classtcat_1_1dice_1_1base.html">base</a>)                            
<a name="l00676"></a>00676     {
<a name="l00677"></a>00677         <a class="code" href="classtcat_1_1dice_1_1reference.html" title="Auto reference helper class.">dice::reference&lt;system_t&gt;</a> <a class="code" href="classtcat_1_1dice_1_1system.html" title="Application wide singleton acts as the STL device tree root.">system</a> = <span class="keyword">new</span> system_t;
<a name="l00678"></a>00678         <span class="keywordflow">try</span>
<a name="l00679"></a>00679         {
<a name="l00680"></a>00680             system-&gt;create();
<a name="l00681"></a>00681         }
<a name="l00682"></a>00682         <span class="keywordflow">catch</span> (...)
<a name="l00683"></a>00683         {
<a name="l00684"></a>00684             <span class="keywordflow">if</span> (system)
<a name="l00685"></a>00685             {
<a name="l00686"></a>00686                 system-&gt;close();
<a name="l00687"></a>00687             }
<a name="l00688"></a>00688             <span class="keywordflow">throw</span>;
<a name="l00689"></a>00689         }
<a name="l00690"></a>00690         <span class="keywordflow">return</span> system;
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <span class="keyword">virtual</span>         ~<a class="code" href="classtcat_1_1dice_1_1system.html" title="Application wide singleton acts as the STL device tree root.">system</a>()
<a name="l00694"></a>00694     {
<a name="l00695"></a>00695         TDL_ENTRY( kTDLFlag_Info | kTDLFlag_PAL, <span class="stringliteral">&quot;PAL [system 0x%x] ~system()&quot;</span>, <span class="keyword">this</span>, 0, 0, 0 );
<a name="l00696"></a>00696 
<a name="l00697"></a>00697         <span class="keywordflow">if</span> (m_open)
<a name="l00698"></a>00698         {
<a name="l00699"></a>00699             TDL_ENTRY( kTDLFlag_Error | kTDLFlag_PAL, <span class="stringliteral">&quot;PAL [system 0x%x] close() should have been called before ~system()&quot;</span>, <span class="keyword">this</span>, 0, 0, 0 );
<a name="l00700"></a>00700             PAL_DEBUG_BREAK     <span class="comment">// the close() method should have been called before trying to destroy the object</span>
<a name="l00701"></a>00701         }
<a name="l00702"></a>00702         super::clear();
<a name="l00703"></a>00703     }                       
<a name="l00704"></a>00704 
<a name="l00705"></a><a class="code" href="classtcat_1_1dice_1_1system.html#a235acbfe76500ea04dfff35ebb528865">00705</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classtcat_1_1dice_1_1system.html#a235acbfe76500ea04dfff35ebb528865" title="system destructor">close</a>()                                                                                        
<a name="l00706"></a>00706     {
<a name="l00707"></a>00707         TDL_ENTRY( kTDLFlag_Info | kTDLFlag_PAL, <span class="stringliteral">&quot;PAL [system 0x%x] close()&quot;</span>, <span class="keyword">this</span>, 0, 0, 0 );
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         <span class="comment">// unmount and close the bus objects</span>
<a name="l00710"></a>00710         <span class="keywordflow">for</span> (<a class="code" href="classtcat_1_1dice_1_1system.html#a925a0fe9c6bd2faf10222644fa39349c" title="bus object iterator">iterator</a> i=super::begin(); i!=super::end(); i++)
<a name="l00711"></a>00711         {
<a name="l00712"></a>00712             (*i)-&gt;unmount();
<a name="l00713"></a>00713             (*i)-&gt;close();
<a name="l00714"></a>00714         }
<a name="l00715"></a>00715         m_open = <span class="keyword">false</span>;
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a><a class="code" href="classtcat_1_1dice_1_1system.html#abb016ac92949b22af68e40f8dde90569">00718</a>     <span class="keyword">virtual</span> bus_t*  <a class="code" href="classtcat_1_1dice_1_1system.html#abb016ac92949b22af68e40f8dde90569" title="This creates a bus object. This is for future use only.">new_bus</a>()<span class="keyword">                               const       </span>{ <span class="keywordflow">return</span> <span class="keyword">new</span> bus_t(); }                 
<a name="l00719"></a>00719 
<a name="l00720"></a><a class="code" href="classtcat_1_1dice_1_1system.html#acf644bb13523cd796bd465d3db057c90">00720</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>    <a class="code" href="classtcat_1_1dice_1_1system.html#acf644bb13523cd796bd465d3db057c90" title="Creates a bus object.">create_bus</a>  (<span class="keyword">const</span> <a class="code" href="classtcat_1_1dice_1_1bus__impl.html#afa72ebc2b0cd6d772a810a1c2596eace" title="(WDM:) bus ID">bus_impl::ID</a> bus_id)             
<a name="l00721"></a>00721     {
<a name="l00722"></a>00722         TDL_ENTRY( kTDLFlag_Info | kTDLFlag_PAL, <span class="stringliteral">&quot;PAL [system 0x%x] create_bus()&quot;</span>, <span class="keyword">this</span>, 0, 0, 0 );
<a name="l00723"></a>00723 
<a name="l00724"></a>00724         <span class="keywordflow">if</span> (!<a class="code" href="classtcat_1_1dice_1_1system.html#a01a043d7880adce93af70b7ba02d0b43" title="&amp;lt; Finds a bus identified by the bus_id in the STL bus list">find</a>(bus_id))  <span class="comment">// check if bus interface is already in STL bus list</span>
<a name="l00725"></a>00725         {
<a name="l00726"></a>00726             <a class="code" href="classtcat_1_1dice_1_1reference.html">bus_ref</a> <a class="code" href="classtcat_1_1dice_1_1bus.html">bus</a>(<a class="code" href="classtcat_1_1dice_1_1system.html#abb016ac92949b22af68e40f8dde90569" title="This creates a bus object. This is for future use only.">new_bus</a>(),<span class="keyword">this</span>);
<a name="l00727"></a>00727             <span class="keywordflow">if</span> (bus)
<a name="l00728"></a>00728             {
<a name="l00729"></a>00729                 <a class="code" href="classtcat_1_1dice_1_1lock.html" title="Auto lock stack class.">lock</a> <a class="code" href="classtcat_1_1dice_1_1lock.html" title="Auto lock stack class.">lock</a>(bus);
<a name="l00730"></a>00730                 bus-&gt;create(<span class="keyword">this</span>,bus_id);
<a name="l00731"></a>00731                 bus-&gt;open();
<a name="l00732"></a>00732                 bus-&gt;fetch();
<a name="l00733"></a>00733                 bus-&gt;fetch_devicelist();
<a name="l00734"></a>00734                 this-&gt;push_front(bus);
<a name="l00735"></a>00735                 bus-&gt;ready_set();
<a name="l00736"></a>00736                 <span class="comment">// bus is created: now notify all subscribers!</span>
<a name="l00737"></a>00737                 bus-&gt;mount();
<a name="l00738"></a>00738                 bus-&gt;update();
<a name="l00739"></a>00739                 bus-&gt;update_devicelist();
<a name="l00740"></a>00740                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00741"></a>00741             }
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 
<a name="l00746"></a><a class="code" href="classtcat_1_1dice_1_1system.html#a4485df1ce1d338bcc2af532f5ea1fe90">00746</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span>    <a class="code" href="classtcat_1_1dice_1_1system.html#a4485df1ce1d338bcc2af532f5ea1fe90" title="&amp;lt; Fetches the bus list into the cached copy of the hardware representation">fetch_buslist</a>() throw(tcat::<a class="code" href="classtcat_1_1dice_1_1system__impl.html#af92e91f046b275fd2ee33b25ceaff06b" title="Exception handler to overwrite.">exception</a>::<a class="code" href="classtcat_1_1dice_1_1base.html">base</a>)                                                
<a name="l00747"></a>00747     {
<a name="l00748"></a>00748         TDL_ENTRY( kTDLFlag_Info | kTDLFlag_PAL, <span class="stringliteral">&quot;PAL [system 0x%x] fetch_buslist()&quot;</span>, <span class="keyword">this</span>, 0, 0, 0 );
<a name="l00749"></a>00749 
<a name="l00750"></a>00750         <span class="keywordtype">bool</span> bReturn = <span class="keyword">false</span>;
<a name="l00751"></a>00751         <a class="code" href="classtcat_1_1dice_1_1lock.html" title="Auto lock stack class.">lock</a> <a class="code" href="classtcat_1_1dice_1_1lock.html" title="Auto lock stack class.">lock</a>(<span class="keyword">this</span>);
<a name="l00752"></a>00752         <span class="comment">// remove not existing busses</span>
<a name="l00753"></a>00753         <span class="keywordflow">for</span> (<a class="code" href="classtcat_1_1dice_1_1system.html#a925a0fe9c6bd2faf10222644fa39349c" title="bus object iterator">iterator</a> i=super::begin(); i!=super::end();)
<a name="l00754"></a>00754             <span class="keywordflow">if</span> (<a class="code" href="classtcat_1_1dice_1_1system__impl.html#a1d0390f2366bd07da97897bf8cc28fc6" title="Return the availabilty in the OS of the the bus of the given ID.">available</a>((*i)-&gt;id()))  <span class="comment">// check if this STL bus list entry is an existing bus interface</span>
<a name="l00755"></a>00755                 i++; <span class="comment">// only increment if item is not to be removed </span>
<a name="l00756"></a>00756             <span class="keywordflow">else</span>
<a name="l00757"></a>00757             {
<a name="l00758"></a>00758                 (*i)-&gt;unmount();
<a name="l00759"></a>00759                 i = this-&gt;erase(i);
<a name="l00760"></a>00760                 bReturn = <span class="keyword">true</span>;
<a name="l00761"></a>00761             }
<a name="l00762"></a>00762         <span class="keywordflow">return</span> <a class="code" href="classtcat_1_1dice_1_1system.html#a4485df1ce1d338bcc2af532f5ea1fe90" title="&amp;lt; Fetches the bus list into the cached copy of the hardware representation">system_impl::fetch_buslist</a>() || bReturn;
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="classtcat_1_1dice_1_1system.html#afcd6ac6b3f7c152a8c48384c453ce58a">00765</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span>    <a class="code" href="classtcat_1_1dice_1_1system.html#afcd6ac6b3f7c152a8c48384c453ce58a" title="Notifies the system object of bus(driver) arrival/removal.">update_buslist</a>()                                                                            
<a name="l00766"></a>00766     {
<a name="l00767"></a>00767         TDL_ENTRY( kTDLFlag_Info | kTDLFlag_PAL, <span class="stringliteral">&quot;PAL [system 0x%x] update_buslist()&quot;</span>, <span class="keyword">this</span>, 0, 0, 0 );
<a name="l00768"></a>00768 
<a name="l00769"></a>00769         <a class="code" href="classtcat_1_1dice_1_1lock.html" title="Auto lock stack class.">lock</a> <a class="code" href="classtcat_1_1dice_1_1lock.html" title="Auto lock stack class.">lock</a>(<span class="keyword">this</span>);
<a name="l00770"></a>00770         <span class="comment">// devices are created; but not notified yet</span>
<a name="l00771"></a>00771         <span class="keywordflow">for</span> (<a class="code" href="classtcat_1_1dice_1_1system.html#a925a0fe9c6bd2faf10222644fa39349c" title="bus object iterator">iterator</a> i=super::begin(); i!=super::end(); i++)
<a name="l00772"></a>00772             (*i)-&gt;update_devices();     
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774 
<a name="l00775"></a><a class="code" href="classtcat_1_1dice_1_1system.html#a01a043d7880adce93af70b7ba02d0b43">00775</a>     <a class="code" href="classtcat_1_1dice_1_1reference.html">bus_ref</a> <a class="code" href="classtcat_1_1dice_1_1system.html#a01a043d7880adce93af70b7ba02d0b43" title="&amp;lt; Finds a bus identified by the bus_id in the STL bus list">find</a>(<span class="keyword">const</span> <a class="code" href="classtcat_1_1dice_1_1bus__impl.html#afa72ebc2b0cd6d772a810a1c2596eace" title="(WDM:) bus ID">bus_impl::ID</a> bus_id) <span class="keyword">const</span>                                                               
<a name="l00776"></a>00776     {
<a name="l00777"></a>00777         <span class="keywordflow">for</span> (<a class="code" href="classtcat_1_1dice_1_1system.html#aed87d285a3f6929ac0331db06f6205fb" title="bus object const iterator">const_iterator</a> <a class="code" href="classtcat_1_1dice_1_1bus.html">bus</a>=self::begin(); <a class="code" href="classtcat_1_1dice_1_1bus.html">bus</a>!=self::end(); <a class="code" href="classtcat_1_1dice_1_1bus.html">bus</a>++)
<a name="l00778"></a>00778         {
<a name="l00779"></a>00779             <span class="keywordflow">if</span> ((*bus)-&gt;id()==bus_id)
<a name="l00780"></a>00780                 <span class="keywordflow">return</span> *<a class="code" href="classtcat_1_1dice_1_1bus.html">bus</a>;
<a name="l00781"></a>00781         }
<a name="l00782"></a>00782         <span class="keywordflow">return</span> NULL;
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 <span class="keyword">protected</span>:
<a name="l00786"></a>00786     <a class="code" href="classtcat_1_1dice_1_1system.html" title="Application wide singleton acts as the STL device tree root.">system</a>():
<a name="l00787"></a>00787         m_open(true)
<a name="l00788"></a>00788     {
<a name="l00789"></a>00789         TDL_ENTRY( kTDLFlag_Info | kTDLFlag_PAL, <span class="stringliteral">&quot;PAL [system 0x%x] system()&quot;</span>, <span class="keyword">this</span>, 0, 0, 0 );
<a name="l00790"></a>00790     }                                                                                                           
<a name="l00791"></a>00791 
<a name="l00792"></a>00792 <span class="keyword">private</span>:
<a name="l00793"></a>00793     <span class="keywordtype">bool</span>    m_open;
<a name="l00794"></a>00794 };
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 <span class="keyword">typedef</span> dice::reference&lt;system&lt;bus&lt;device&gt; &gt; &gt; system_ref;  
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 
<a name="l00801"></a>00801 } <span class="comment">// namespace dice</span>
<a name="l00802"></a>00802 } <span class="comment">// namespace tcat</span>
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 
<a name="l00805"></a>00805 <span class="preprocessor">#undef kDriverLog_File_ID</span>
</pre></div></div>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<title>Platform Abstraction Layer API Documentation</title>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<link href="doxygen.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<hr size="1">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td><small><font face="Verdana, Arial, Helvetica, sans-serif">(C) COPYRIGHT 2007-2013 TC Applied Technologies, Ltd. (ALL RIGHTS RESERVED)</font></small></td>
				<td colspan="2" align="right"><font face="Verdana, Arial, Helvetica, sans-serif">Compiled on 14 Jun 2013</font></td>
			</tr>
		</table>
	</body>
</html>
